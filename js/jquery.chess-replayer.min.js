/*
 Chess Replayer 1.1.6
 Copyright (c) 2012 Andrew Hoy
 http://github.com/andrewphoy/chess-replayer
 MIT License
*/
(function(){var h=!0,i=null,j=!1,k=jQuery,p=window,q=document;
function r(a,b,c,d,e,f,g){this.M=a;this.Wa=b;this.move=c;this.m=d;this.Ba=e;this.ka=f;this.W=g;this.j=[];this.children=[];this.la=function(a){"$"==a.charAt(0)&&(a=a.substring(1));switch(parseInt(a,10)){case 1:return"!";case 2:return"?";case 3:return"!!";case 4:return"??";case 5:return"!?";case 6:return"?!";case 7:case 8:return"&#x25a1;";case 10:return"=";case 13:return"&infin;";case 14:return"&#x2a72;";case 15:return"&#x2a71;";case 16:return"&plusmn;";case 17:return"&#8723;";case 18:return"&#43;&minus;";
case 19:return"&minus;&#43;";case 22:case 23:return"&#x2a00;";case 32:case 33:return"&#x27F3;";case 36:case 37:return"&#x2192;";case 40:case 41:return"&#x2191;";case 132:case 133:return"&#x21c6;";case 140:return"&#x2206;";case 142:return"&#x2313;";case 145:return"RR";case 146:return"N";case 239:return"&#x21d4;";case 240:return"&#x21d7;";case 242:return"&#x27eb;";case 243:return"&#x27ea;";case 244:return"&#x2715;";case 245:return"&#x22a5;";default:return""}};this.o=function(a){var b="";a&&(b+=this.Wa+
" ");b+=this.move;if(this.ka)for(var a=this.ka.split(" "),b=b+this.la(a[0]),c=1;c<a.length;c++)b+=" "+this.la(a[c]);return b};this.toString=function(){return this.o(j)};this.da=function(a,b,c){c=c||1==this.W%2||0==this.m;a=a="<span id='"+a+"move"+this.M+"' class='move move"+b+"'>";return a+=this.o(c)+"</span>"}}
function s(a,b){this.c=a;this.c.id||(this.c.id="cr"+Math.random().toString(36).substring(5));this.g=k(a);this.options=b;this.ea=this.g.data("replayer-options");this.a={headers:[],result:"",e:0,h:1,C:"",G:0,jb:0,position:[],aa:-1,O:-1,kb:"KQ",ib:"kq",U:j,f:[]};this.d={B:j,n:j,I:j,fa:0,k:0,direction:-1}}
s.prototype={H:{fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",fenOnly:j,size:"small",lightColor:"#CCCCCC",darkColor:"#999999",startPly:j,boardOnly:j,hideTitle:j,hideControls:j,hideAnnotations:j,showAnnotations:j,scrollOnEnd:j,startFlipped:j},size:{w:45,v:60,u:80},shift:{left:{w:3,v:10,u:20},top:{w:2,v:8,u:20}},i:{ua:"((?:\\s*\\$\\d+)*)(\\s*\\{[^\\}]*\\})*",Ga:/(0-1|1-0|1\/2-1\/2|\*)\s*$/,Ca:/\{([^}]*?)(\()(.*?)\}/g,Da:/\{([^}]*?)(\))(.*?)\}/g,ya:/^O-O/,za:/^O-O-O/,qa:/^([KQBNR])/,
$a:/(.*)([a-h])([1-8])/,ab:/^[KQBNR]([a-h])?([1-8])?x?[a-h][1-8]/,oa:/^([a-h])([1-8])/,na:/^([a-h])x([a-h])([1-8])/,pa:/=([QBNR])/},A:{fb:[-16,-1,1,16],Ra:[-33,-31,-18,-14,14,18,31,33],xa:[-17,-15,15,17],eb:[-17,-15,15,17,-16,-1,1,16],Qa:[-17,-16,-15,-1,1,15,16,17]},Na:function(){this.Z=k.extend({},this.options,this.ea);this.b=k.extend({},this.H,this.options,this.ea);this.Aa();this.Ya();this.bb();this.cb();this.wa();this.Va();this.va()},va:function(){var a=this;this.g.keydown(function(b){return 39==
b.which?(a.L(j),j):37==b.which?(a.D(j),j):40==b.which&&a.d.n?(b.preventDefault(),a.Ta(),j):38==b.which&&a.d.n?(b.preventDefault(),a.Ua(),j):70==b.which?(a.R(),j):83==b.which||36==b.which||72==b.which?(a.ia(),j):69==b.which||35==b.which?(b.ctrlKey?a.K():a.ga(),j):27==b.which?(a.t(),a.z(),a.P(),j):h});k(".board,.moves",this.c).bind("mousewheel DOMMouseScroll",function(b){var c=j;(c=0<(-b.originalEvent.detail||b.wheelDelta||b.originalEvent.wheelDelta)?a.D(j):a.L(j))&&b.preventDefault();return!c&&a.b.scrollOnEnd});
k(".next",this.c).click(function(){a.L(j);return j});k(".back",this.c).click(function(){a.D(j);return j});k(".start",this.c).click(function(){a.ia();return j});k(".flip",this.c).click(function(){a.R();return j});k(".end",this.c).click(function(){a.K();return j});k(".move",this.c).click(function(){var b=this.id.substring(a.c.id.length+4);"-end"==b?a.K():a.ja(b);return j});k(".arrow",this.c).click(function(){a.hb();return j})},Aa:function(){this.b.size=this.b.size.toLowerCase();"small"!=this.b.size&&
"large"!=this.b.size&&(this.b.size="medium")},S:function(){return"small"==this.b.size?this.shift.left.w:"large"==this.b.size?this.shift.left.u:this.shift.left.v},T:function(){return"small"==this.b.size?this.shift.top.w:"large"==this.b.size?this.shift.top.u:this.shift.top.v},s:function(){return this.g.find(".board")},Y:function(){return this.g.find(".title")},ba:function(){return this.g.find(".controls")},l:function(){return this.g.find(".moves")},ma:function(){return this.g.find(".notes")},gb:function(a){!this.b.boardOnly&&
!this.b.hideAnnotations&&this.ma().html(a)},p:function(){return"small"==this.b.size?this.size.w:"large"==this.b.size?this.size.u:this.size.v},t:function(){k(q).unbind("click.replayer");k(".context-menu",this.c).unbind("click");k(".context-menu",this.c).remove();this.d.B=j},hb:function(){if(this.d.B)this.t();else{k(".arrow",this.c).append('<div class="modal context-menu"><ul><li class="game">Copy Game</li><li class="pos">Copy Position</li><li class="startpos">Copy Start Position</li></ul>');this.d.B=
h;k(".context-menu",this.c).css({top:10,left:25,"font-size":"small"});var a=this;k(".context-menu ul li",this.c).click(function(b){var c=k(this).attr("class");b.stopPropagation();a.t();switch(c){case "game":a.X("Copy this pgn to your computer",a.Ma());break;case "pos":a.X("Copy this FEN to your computer",a.Ia());break;case "startpos":a.X("Copy this FEN to your computer",a.b.fen)}});k(".context-menu",this.c).click(function(){return j});k(q).bind("click.replayer",function(b){a.t();k(this).unbind(b)})}},
z:function(){k(q).unbind("click.replayer");k(".copy-paste",this.c).remove();this.d.I=j},X:function(a,b){this.d.I&&this.z();this.s().append('<div class="modal copy-paste"><p>'+a+"</p><textarea>"+b+"</textarea><button>Done</button></div>");this.d.I=h;k(".copy-paste",this.c).css({position:"fixed",left:p.screen.width/2-215,top:p.screen.height/2-150,width:430,height:300});k(".copy-paste textarea",this.c).select();var c=this;k(".copy-paste",this.c).click(function(){return j});k(".copy-paste button",this.c).click(function(){c.z()});
k(q).bind("click.replayer",function(a){c.z();k(this).unbind(a)})},cb:function(){if(!this.b.boardOnly){var a=this.g.width(),b=8*this.p();k(".moves",this.c).width(a-b-10);k(".moves",this.c).height(b);a={q:[]};this.o(0,a,0,h,h);this.l().html(a.q.join(" "))}},o:function(a,b,c,d,e){a=this.a.f[a];d||b.q.push(a.da(this.c.id,c,e));d=a.children.length;if(1==d)this.o(a.children[0],b,c,j,j);else if(0==d)0<c?(b.q.push(")"),1==c&&b.q.push("<br />")):b.q.push("<span id='"+this.c.id+"move-end' class='move move0'>"+
this.a.result+"</span>");else{d=a.children[a.children.length-1];b.q.push(this.a.f[d].da(this.c.id,c,j));0==c&&b.q.push("<br />");for(e=0;e<a.children.length-1;e++)b.q.push("("),this.o(a.children[e],b,c+1,j,h);this.o(d,b,c,h,j)}},getHeader:function(a){if(this.b.headers==i)return i;a=a.toLowerCase();return this.b.headers.hasOwnProperty(a)?this.b.headers[a]:i},La:function(a){var b=this.getHeader("Title");if(b!=i)return b;if(this.b.fenOnly)return i;var a=a==h?"<br />":", ",c=this.getHeader("White")||
"NN",d=this.getHeader("Black")||"NN",b=this.getHeader("Event"),e=this.getHeader("Date")||this.getHeader("EventDate")||this.getHeader("UTCDate"),c=c+" - "+d;b!=i&&"?"!==b&&(c+=a+b);e!=i&&0<e.length&&(c+=a+e.replace(/\./g,"-"));this.a.result!=i&&0<this.a.result.length&&(c+=a+this.a.result);return c},Ya:function(){var a=k.trim(this.g.html());this.$(a)?(this.b.fen=a,this.b.boardOnly=h,this.b.hideControls=h,this.b.hideAnnotations=h,this.b.fenOnly=h,this.a.f=this.ra().r):(this.b.pgn=a,this.b.pgn&&this.Za());
this.Xa()},$:function(a){return/^\s*([rnbqkpRNBQKP1-8]+\/){7}([rnbqkpRNBQKP1-8]+)\s[bw-]\s(([a-hkqA-HKQ]{1,4})|(-))\s(([a-h][36])|(-))\s\d+\s\d+\s*$/.test(a)},Za:function(){var a=this.b.pgn;if("["==a.charAt(0)){var b=a.split("\n\n");if(!(2>b.length)){for(var a=/\[([\w\d]+)\s+"(.*?)"/g,c,d={},e={};c=a.exec(b[0]);)e[c[1]]=c[2],d[c[1].toLowerCase()]=c[2];this.b.rawHeaders=e;this.b.headers=d;2<b.length?(b.splice(0,1),a=b.join(" ")):a=b[1];b=this.getHeader("fen");b!=i&&this.$(b)&&(this.b.fen=b)}}b=a;this.b.pgnBody=
b;a=this.ra();b=b.replace(/(\r\n|\n|\r)/gm," ");b=b.replace(this.i.Ca,"{$1&lpar;$3}");b=b.replace(this.i.Da,"{$1&rpar;$3}");b=this.Sa(b);b=b.replace("&lpar;","(");b=b.replace("&rpar;",")");c=this.i.Ga.exec(b);c!=i&&2<=c.length&&(this.a.result=c[1]);d=-1;c=/(\d+)(\.+)/.exec(b);c!=i&&(d=2*c[1],"."==c[2]&&(d-=1));0<d&&this.Q(a,0,d,b);this.a.f=a.r},ra:function(){var a={r:[],e:0};a.r[0]=new r(0,i,i,-1,"",i,i);return a},Sa:function(a){for(var b=0,c=h,d=/\(([^(]*?)\)/g;c;)a.match(d)&&(a=a.replace(d,"%%"+
b+"% $1 %"+b+"%%")),c=j,a.match(d)&&(c=h,b+=1);return a},Q:function(a,b,c,d){for(var e=this.V(c),f=RegExp("%%(\\d+)%\\s*"+e+"\\s*(\\w\\S+)"+this.i.ua+"(?:\\s+(.*?))?%\\1%%","g"),g,m;(g=f.exec(d))!==i;){m=k.trim(g[2]);var l="",n="";g[3]&&(n=k.trim(g[3]));if(g[4]){for(l=k.trim(g[4]);"{"===l.charAt(0);)l=l.substr(1);for(;"}"===l.charAt(l.length-1);)l=l.slice(0,-1);0<l.length&&(this.a.U=h)}a.e++;a.r[a.e]=new r(a.e,e.replace(/\\/g,""),m,b,l,n,c);a.r[b].children.push(a.e);g=g[5];g!=i&&(g=k.trim(g),0<g.length&&
isNaN(g.charAt(0))&&(g=this.V(c+1).replace(/\\/g,"")+" "+g),this.Q(a,a.e,c+1,g))}d=d.replace(f,"");g=RegExp("(?:^|\\s+)"+e+"\\s*(\\w\\S+)"+this.i.ua+"(?:\\s+(.*)|($))","m").exec(d);if(g!=i){m=k.trim(g[1]);n=l="";g[2]&&(n=k.trim(g[2]));if(g[3]){for(l=k.trim(g[3]);"{"===l.charAt(0);)l=l.substr(1);for(;"}"===l.charAt(l.length-1);)l=l.slice(0,-1);0<l.length&&(this.a.U=h)}a.e++;a.r[a.e]=new r(a.e,e.replace(/\\/g,""),m,b,l,n,c);a.r[b].children.push(a.e);g=g[4];g!=i&&(g=k.trim(g),0<g.length&&isNaN(g.charAt(0))&&
(g=this.V(c+1).replace(/\\/g,"")+" "+g),this.Q(a,a.e,c+1,g))}},V:function(a){var b=Math.ceil(a/2).toString(),c="\\.";0==a%2&&(c="\\.\\.\\.");return b+c},Xa:function(){if(this.$(this.b.fen)){for(var a=this.b.fen.split(" "),b=a[0].split("/"),c=112,d=0,e=0;8>e;e++){for(var f=d=0;8>f;f++){var g=b[e].charAt(d);if(g!=i&&isNaN(g)){var m=g.toLowerCase()==g?"b":"w";this.a.position[c+f]=m+g.toLowerCase();"k"==g.toLowerCase()&&("w"==m?this.a.aa=c+f:this.a.O=c+f)}else f+=Math.max(+g-1,1);d++}c-=16}"b"==a[1]&&
(this.a.h=-1)}},Ma:function(){if(this.b.fenOnly)return"";for(var a="",b="Event Site Date Round White Black Result".split(" "),c=0;7>c;c++){var d=this.getHeader(b[c]);if(d==i||0==d.length)d="?";a+="["+b[c]+' "'+d+'"]\n'}var c=this.b.rawHeaders,e;for(e in c)0>k.inArray(e,b)&&c.hasOwnProperty(e)&&(a+="["+e+' "'+c[e]+'"]\n');return a+"\n"+this.b.pgnBody},Ia:function(){return this.Ja()},Ja:function(){for(var a="",b=112,c=0;0<=b;)if(0<(b&136))0<c&&(a+=c.toString(10),c=0),b-=24,0<=b&&(a+="/");else{if(this.a.position[b]!=
i&&0<this.a.position[b].length){0<c&&(a+=c.toString(),c=0);var d=this.a.position[b],a=a+("w"==d.charAt(0)?d.charAt(1).toUpperCase():d.charAt(1).toLowerCase())}else c++;b++}return a},bb:function(){this.g.empty();this.g.attr("tabindex",-1);if(!this.b.hideTitle&&0==this.Y().size()){var a=this.La(j);a!=i&&0<a.length&&(this.g.append('<div class="title"></div>'),this.Y().html(a),this.Y().append('<div class="arrow" />'))}0==this.s().size()&&(this.g.append('<div class="board"></div>').css({position:"relative"}),
(this.b.boardOnly||this.b.hideAnnotations)&&this.g.width(8*this.p()));this.b.boardOnly||0==this.l().size()&&this.g.append('<div class="moves"></div>');this.b.hideControls||0==this.ba().size()&&this.g.append('<div class="controls"></div>');!this.b.boardOnly&&!this.b.hideAnnotations&&0==this.ma().size()&&(this.a.U||this.b.showAnnotations)&&this.g.append('<div class="notes"></div>');var a=this.s(),b=this.p(),c=this.b.lightColor,d=this.b.darkColor,e,f;f="<table class='chess-replayer-board'>";for(var g=
7;0<=g;g--){f+="<tr>";for(var m=0;7>=m;m++)e=0==(m+g)%2?d:c,f+="<td style='min-width: "+b+"px; width: "+b+"px; min-height: "+b+"px; height: "+b+"px; background-color: "+e+";'></td>";f+="</tr>"}f+="</table>";this.g.addClass("chess-replayer");a.html(f);this.ba().html('<a class="start button" href="#">|< Start</a><a class="back button" href="#"><< Back</a><a class="flip button" href="#">Flip</a><a class="next button" href="#">Next >></a><a class="end button" href="#">End >|</a>')},wa:function(){for(var a=
this.p(),b=this.s(),c=this.S(),d=this.T(),e=7;0<=e;e--)for(var f=0;7>=f;f++){var g=16*e+f,m=this.a.position[g];if(m!=i){g=this.c.id+g;b.append("<div id='"+g+"' class='"+m+"-"+this.b.size+" chess-piece'></div>");var m=a*(7-e)+d,l=a*f+c;k("#"+g).css({position:"absolute",top:m,left:l,height:a+"px",width:a+"px"})}}},R:function(){var a=this.p(),b=this.s(),c=7*a,d=this.S(),e=this.T(),f,g,m,l,n=this,t=setInterval(function(){k(".chess-piece",b).is(":animated")||(clearInterval(t),b.children(".chess-piece").each(function(){f=
parseInt(k(this).css("top"),10)-e;g=parseInt(k(this).css("left"),10)-d;l=c-g+d;m=c-f+e;k(this).css({position:"absolute",top:m,left:l})}),n.d.direction*=-1)},100)},Va:function(){var a=j;this.b.startFlipped&&(a=h);if(!("startFlipped"in this.Z)){-1==this.a.h&&(a=h);var b=this.getHeader("StartFlipped");b!=i&&(a="true"==b.toLowerCase()||"1"==b?h:j)}var b=0,c="startPly"in this.Z?parseInt(this.Z.startPly,10):parseInt(this.getHeader("StartPly"),10);c!=i&&0<c&&(b=c);a&&this.R();if(0<b&&(c=this.a.f[0],this.a.f[c.children[c.children.length-
1]].W<b))for(a=0;c!=i&&0<c.children.length&&a<b;)a=c.children[c.children.length-1],this.J(a,h),c=this.a.f[a],a=c.W},ia:function(){for(;0<this.a.G;)this.D(h)},ja:function(a){a=parseInt(a,10);if(a!=i&&a!=this.a.e){for(var b=[this.a.e],c=this.a.f[this.a.e];0<=c.m;)b.unshift(c.m),c=this.a.f[c.m];for(var d=[a],c=this.a.f[a];0<=c.m;)d.unshift(c.m),c=this.a.f[c.m];for(var c=0,e=Math.min(b.length,d.length),f=0;f<e&&b[f]==d[f];f++)c=b[f];for(;this.a.e>c;)this.D(h);if(this.a.e!=a)for(;this.a.e<a;)this.J(d[f],
h),f++}},K:function(){this.ja(this.a.f.length-1)},ga:function(){for(var a=this.a.f[this.a.e];a!=i&&0<a.children.length;)a=a.children[a.children.length-1],this.J(a,h),a=this.a.f[a]},L:function(a){this.d.B&&this.t();this.d.I&&this.z();var b=this.a.f[this.a.e];if(0==b.children.length)return j;if(1==b.children.length||this.d.n){var c=b.children[b.children.length-1];this.d.n&&(c=b.children[this.d.k],this.P());this.J(c,a)}else this.Ea(b);return h},P:function(){this.d.n&&(this.d.n=j,k(".modal li",this.c).unbind("click"),
k(".modal",this.c).remove(),this.g.focus())},Ea:function(a){this.d.B&&this.t();for(var b=a.children.length,c="",c='<div class="modal"><ul>',d=b-1;0<=d;d--)c+='<li class="'+d+'">'+this.a.f[a.children[d]].o(h)+"</li>";this.s().append(c+"</ul></div>");a=8*this.p();k(".modal",this.c).css({top:10,left:a+20});var e=this;k(".modal li",this.c).click(function(a){a=parseInt(k(a.target).attr("class"),10);e.d.k=a;e.L(j)});this.d.n=h;this.d.k=b-1;this.d.fa=b;k(".modal ."+this.d.k,this.c).toggleClass("selected")},
Ua:function(){this.d.k+1>=this.d.fa||(this.d.k++,k(".modal .selected",this.c).toggleClass("selected"),k("."+this.d.k,".modal").toggleClass("selected"))},Ta:function(){0>=this.d.k||(this.d.k--,k(".modal .selected",this.c).toggleClass("selected"),k("."+this.d.k,".modal").toggleClass("selected"))},J:function(a,b){if(a!=i){var c=this.a.f[a];this.ta(c);this.ca(c,1,b);this.a.G++;this.a.e=a;this.a.h*=-1}},D:function(a){if(this.d.n)return this.P(),h;if(0<this.a.G){var b=this.a.f[this.a.e],c=b.m;this.ta(this.a.f[c]);
this.ca(b,-1,a);this.a.G--;this.a.e=c;this.a.h*=-1;return h}return j},ta:function(a){this.gb(a.Ba);k(".active",this.c).toggleClass("active");var b=k("#"+this.c.id+"move"+a.M.toString());b.toggleClass("active");if(0<a.M&&!this.b.boardOnly){a=b.position().top;b=b.height();if(a<b){var c=b-a,d=this.l().scrollTop();d>c?this.l().scrollTop(d-c):0<d&&this.l().scrollTop(0)}a+b>this.l().height()&&(a=a+b-this.l().height(),this.l().scrollTop(this.l().scrollTop()+a))}},Pa:function(a){return"Q"==a||"R"==a||"B"==
a},Ka:function(a){switch(a){case "Q":return this.A.eb;case "R":return this.A.fb;case "B":return this.A.xa;case "N":return this.A.Ra;case "K":return this.A.Qa}},Fa:function(a,b){for(var c=this.Pa(a),d=this.Ka(a),e=(1==this.a.h?"w":"b")+a.toLowerCase(),f=[],g,m,l=0;l<d.length;l++){m=d[l];for(g=b+m;!(g&136);){if(this.a.position[g]!=i){this.a.position[g]==e&&f.push(g);break}g+=m;if(!c)break}}return f},Ha:function(a){if(this.i.za.test(a.move)){var a=1==this.a.h?0:7,b=16*a+4,a=16*a;return["m:"+b.toString()+
":"+(b-2).toString(),"m:"+a.toString()+":"+(a+3).toString()]}if(this.i.ya.test(a.move))return a=1==this.a.h?0:7,b=16*a+4,a=16*a+7,["m:"+b.toString()+":"+(b+2).toString(),"m:"+a.toString()+":"+(a-2).toString()];if(this.i.qa.test(a.move)){var b=this.i.qa.exec(a.move)[0],c=this.i.$a.exec(a.move),d=c[3]-1,c=c[2].toLowerCase().charCodeAt(0)-97,d=16*d+c,c=this.Fa(b,d),b=[];if(1==c.length)b=["m:"+c[0]+":"+d];else{var e=this.i.ab.exec(a.move);if(e[1]!=i&&""!=e[1]){for(var f=[],g=e[1].toLowerCase().charCodeAt(0)-
97,a=0;a<c.length;a++)c[a]%16==g&&f.push(c[a]);c=f}if(e[2]!=i&&""!=e[2]){f=[];e=e[2]-1;for(a=0;a<c.length;a++)Math.floor(c[a]/16)==e&&f.push(c[a]);c=f}if(1==c.length)b=["m:"+c[0]+":"+d];else{e=[];f=1==this.a.h?this.a.aa:this.a.O;for(a=0;a<c.length;a++)this.Oa(c[a],f)||e.push(c[a]);1==e.length&&(b=["m:"+e[0]+":"+d])}}this.a.position[d]!=i&&b.splice(0,0,"r:"+d+":"+this.a.position[d].toString())}else{e=c=d=i;b=[];f=1==this.a.h?"w":"b";if(this.i.oa.test(a.move))if(b=this.i.oa.exec(a.move),c=b[1].toLowerCase().charCodeAt(0)-
97,d=b[2]-1,b=d-1*this.a.h,b=16*b+c,this.a.position[b]==f+"p")e=b,b=["m:"+b+":"+(16*d+c).toString()];else{if(1==this.a.h){if(3==d&&"wp"==this.a.position[16+c]&&this.a.position[32+c]==i)return b=["m:"+(16+c).toString()+":"+(48+c).toString(),"e:"+c.toString()]}else if(4==d&&"bp"==this.a.position[96+c]&&this.a.position[80+c]==i)return b=["m:"+(96+c).toString()+":"+(64+c).toString(),"e:"+c.toString()];return[]}else if(this.i.na.test(a.move)){b=this.i.na.exec(a.move);c=b[2].toLowerCase().charCodeAt(0)-
97;d=b[3]-1;f=b[1].toLowerCase().charCodeAt(0)-97;b=d-1*this.a.h;if(this.a.C===c.toString(10)&&(e=i,1==this.a.h&&5==d&&(e=64+c),-1==this.a.h&&2==d&&(e=48+c),e!=i))return["r:"+e.toString()+":"+this.a.position[e],"m:"+(16*b+f).toString()+":"+(16*d+c).toString()];e=16*b+f;b=["r:"+(16*d+c).toString()+":"+this.a.position[16*d+c],"m:"+(16*b+f).toString()+":"+(16*d+c).toString()]}if(this.i.pa.test(a.move)){f=this.i.pa.exec(a.move)[1];g=1==this.a.h?"w":"b";d=(16*d+c).toString();c=[];for(a=0;a<b.length;a++)"m"!=
b[a].split(":")[0]&&c.push(b[a]);c.push("p:"+d+":"+e.toString()+":"+g+":"+f.toLowerCase());b=c}}return b},Oa:function(a,b){var c=a-b,d=Math.abs(c),e=i;0<d&&7>d?e=1:0==d%15?e=15:0==d%16?e=16:0==d%17&&(e=17);if(e!==i){d=e;0>c&&(e*=-1);for(var c=b+e,f=j;!(c&136);){if(this.a.position[c]!=i)if(c==a)f=h;else{if(f){e=this.a.position[c];c=e.charAt(1);if(e.charAt(0)!=(1==this.a.h?"b":"w"))break;return 15==d||17==d?"q"==c||"b"==c:"r"==c||"q"==c}break}c+=e}}return j},ca:function(a,b,c){"undefined"===typeof c&&
(c=j);if(0<b){if(a.j==i||0==a.j.length)b=this.Ha(a),this.a.f[a.M].j=b,a.j=b;this.a.C="";for(b=0;b<a.j.length;b++){var d=a.j[b],d=d.split(":");switch(d[0]){case "m":this.ha(d[1],d[2],c);break;case "a":this.F(d[1],d[2]);break;case "r":this.N(d[1]);break;case "e":this.a.C=d[1];break;case "p":this.N(d[2]),this.F(d[1],d[3]+d[4])}}}else if(0>b){if(a.j==i)return j;d=this.a.f[a.m];if(d!=i&&d.j!=i){for(var e=j,b=0;b<d.j.length;b++)"e"==d.j[b].charAt(0)&&(e=h,this.a.C=parseInt(d.j[b].charAt(2),8));e||(this.a.C=
"")}for(b=a.j.length-1;0<=b;b--)switch(d=a.j[b],d=d.split(":"),d[0]){case "m":this.ha(d[2],d[1],c);break;case "a":this.N(d[1]);break;case "r":this.F(d[1],d[2]);break;case "p":this.N(d[1]),this.F(d[2],d[3]+"p")}}},F:function(a,b){var c=this.c.id+a;this.s().append("<div id='"+c+"' class='"+b+"-"+this.b.size+" chess-piece'></div>");var d=this.p(),e=Math.floor(a/16),f=a%16;-1==this.d.direction?e=7-e:f=7-f;e=d*e+this.T();f=d*f+this.S();k("#"+c).css({position:"absolute",top:e,left:f,height:d+"px",width:d+
"px"});this.a.position[a]=b},N:function(a){k("#"+(this.c.id+a)).remove();this.a.position[a]=i},ha:function(a,b,c){var d=this.c.id+a,e=this.c.id+b,f=this.p(),g=(Math.floor(b/16)-Math.floor(a/16))*f*this.d.direction,f=(a%16-b%16)*f*this.d.direction;c?k("#"+d).css({top:"+="+g+"px",left:"+="+f+"px"}):k("#"+d).animate({top:"+="+g+"px",left:"+="+f+"px"},"fast");k("#"+d).attr("id",e);c=this.a.position[a];this.a.position[b]=c;this.a.position[a]=i;"wk"===c&&(this.a.aa=b);"bk"===c&&(this.a.O=b)}};s.H=s.prototype.H;
k.fn.sa=function(a){return this.each(function(){(new s(this,a)).Na()})};jQuery.prototype.replayer=k.fn.sa;k.fn.sa.defaults=s.H;})()